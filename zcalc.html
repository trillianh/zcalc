<!DOCTYPE html>
<style>
body{
	font-family: sans-serif;
}
</style>
<meta charset="utf-8">
<html>
<h1 style="text-align: 	center"></h1>
<body onkeyup="refresh()" onkeydown="refresh()" onclick="refresh()" onload="firstload()">
<center>
<script>
var bsp = 2250;
var steel = 21030;
var bronze = 29670;
var brass = 31590;
var calph = 50790;
var bal = 28710;
var distance = 2.1385;
var getCrateValue = function(price,tradelevel){
	var bargain = 1.05+tradelevel*0.005;
	var bonus = bargain * distance;
	var crateprice = price*bonus;
	if(tradelevel>41){
		crateprice *= 1.5;
	}
	return parseInt(crateprice);
}
var getMetalZero = function(price,tradelevel){
	var bargain = 1.05+tradelevel*0.005;
	var bonus = bargain * distance;
	var crateprice = price*bonus;
	if(tradelevel>41){
		crateprice *= 1.5;
	}
	return parseInt((crateprice-bsp)/10);
}
var getCalphZero = function(price,tradelevel){
	var bargain = 1.05+tradelevel*0.005;
	var bonus = bargain * distance;
	var crateprice = price*bonus;
	if(tradelevel>41){
		crateprice *= 1.5;
	}
	return parseInt((crateprice-(bsp+110250))/5);
}
var getBalZero = function(price,tradelevel){
	var bargain = 1.05+tradelevel*0.005;
	var bonus = bargain * distance;
	var crateprice = price*bonus;
	if(tradelevel>41){
		crateprice *= 1.5;
	}
	return parseInt((crateprice-(bsp+8820*5))/5);
}
function firstload(){
var url_string = window.location.href;
var url = new URL(url_string);
if(url.searchParams.get("tl")){
var tl = parseInt(url.searchParams.get("tl"));
var tt = 4;
if(tl>80){
tl -= 80;
tt = 6; 
}
else if(tl>50){
	tl -= 50;
	tt = 5;
}
else{
	tt = Math.floor(tl / 10);
	tl = tl % 10;
}
document.getElementById("tradetitle").selectedIndex	= tt;
document.getElementById("tradelevelt").value = tl;
}
refresh();
}
function refresh(){
	var tl = 1;
	var selectedtrade = document.getElementById("tradetitle").selectedIndex;
	var selectedlocation = document.getElementById("location").selectedIndex;
	if(selectedlocation==0){
		distance = 2.1385;
	}
	else if(selectedlocation==1){
		distance = 2.0407;
	}
	else if(selectedlocation==2){
		distance = 1.9984;
	}
	if(selectedtrade==6){
		selectedtrade += 2
	}
	tl = selectedtrade*10 + parseInt(document.getElementById("tradelevelt").value);
	bsp = parseInt(document.getElementById("bspprice").value);
	document.getElementById("finaltradelevel").value = tl;
	document.getElementById("steelvalue").innerHTML = getMetalZero(steel,tl);//getZero(steel,) + "";
	document.getElementById("bronzevalue").innerHTML = getMetalZero(bronze,tl);
	document.getElementById("brassvalue").innerHTML = getMetalZero(brass,tl);
	document.getElementById("calphvalue").innerHTML = getCalphZero(calph,tl);
	document.getElementById("balvalue").innerHTML = getBalZero(bal,tl);

	document.getElementById("steelratio").innerHTML = Math.round((getCrateValue(steel,tl)/parseInt(document.getElementById("steelprice").value*10+bsp))*10000)/10000;
	document.getElementById("bronzeratio").innerHTML = Math.round((getCrateValue(bronze,tl)/parseInt(document.getElementById("bronzeprice").value*10+bsp))*10000)/10000;
	document.getElementById("brassratio").innerHTML = Math.round((getCrateValue(brass,tl)/parseInt(document.getElementById("brassprice").value*10+bsp))*10000)/10000;
	document.getElementById("calphratio").innerHTML = Math.round(((getCrateValue(calph,tl))/parseInt(document.getElementById("firprice").value*5+110250+bsp))*10000)/10000;
	document.getElementById("balratio").innerHTML = Math.round(((getCrateValue(bal,tl))/parseInt(document.getElementById("mapleprice").value*5+44100+bsp))*10000)/10000;
	var url_string = window.location.href;
	if(url_string.includes("&tl")){
		url_string = url_string.substring(0,url_string.indexOf("&tl")+4)+tl;
	}
	else{
		url_string+="?&tl="+tl;
	}
	document.getElementById("urlsave").value = url_string;
	//document.getElementById("calphvalue").innerHTML = getZero(calph,tl);
	//document.getElementById("balvalue").innerHTML = getZero(bal,tl);

}
</script>
<p>This calculator assumes you always take the desert buff if you're high enough level.</p>

<select id = "location" onclick="refresh()">
  <option value="grana">Grana</option>
  <option value="oldwisdom">Old Wisdom</option>
  <option value="trent">Trent</option>
</select>
<select id = "tradetitle">
  <option value="beg">Beginner</option>
  <option value="app">Apprentice</option>
  <option value="ski">Skilled</option>
  <option value="pro">Professional</option>
  <option value="art" selected="selected">Artisan</option>
  <option value="mas">Master</option>
  <option value="gur">Guru</option>
</select>
  <input type="text" id="tradelevelt" value="2" size="1">
  <p>Trade Level:
    <input type="text" id="finaltradelevel" value="" size="1">
  </p>
  <p>BSP Value: <input type="text" id="bspprice" value="2250" size="3"></p>
  <table>
  	<tr>
  		<th></th><th>Zero</th><th></th><th>Buy</th><th>Margin</th>
  	</tr>
  	<tr><td>Steel:</td><td id="steelvalue">0</td><td></td><td><input type="text" id="steelprice" value="7382" size="1"></td><td id="steelratio">1</td>
  	</tr>
  	<tr><td>Bronze:</td><td id="bronzevalue">0</td><td></td><td><input type="text" id="bronzeprice" value="10800" size="1"></td><td id="bronzeratio">1</td>
  	</tr>
  	<tr><td>Brass:</td><td id="brassvalue">0</td><td></td><td><input type="text" id="brassprice" value="11635" size="1"></td><td id="brassratio">1</td>
  	</tr>
  	<tr><td>Calph:</td><td id="calphvalue">0</td><td style="text-align: center;">(fir)</td><td><input type="text" id="firprice" value="16569" size="1"></td><td id="calphratio">1</td>
  	</tr>
  	<tr><td>Balenos:</td><td id="balvalue">0</td><td style="text-align: center;">(maple)</td><td><input type="text" id="mapleprice" value="11084" size="1"></td><td id="balratio">1</td>
  	</tr>
  </table>
  <p></p>
  <p><input type="text" id="urlsave" size="50" onClick="this.select();">
  </center>
</body>
</html>